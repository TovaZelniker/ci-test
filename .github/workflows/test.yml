name: 🧪 Run server tests

on: push

env:
  MONGO_URI: test

jobs:
  test:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: ./server

    steps:
        - name: 📂 Checkout code
          uses: actions/checkout@v4

        - name: 🛠️ Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: "20"

        - name: ⏬ Install dependencies
          run: |
            npm install
            npm install --save-dev @shelf/jest-mongodb
            npm install --save-dev mongodb-memory-server

        - name: ✅ Run test
          run: |
            npm test
            npm run test:e2e